<!doctype html>
<html>
<head>
		<meta charset="utf-8">
		<title>Real-Time Geolocation with Web Sockets</title>
		<link href='http://fonts.googleapis.com/css?family=Lato:300,400' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4/leaflet.css" />
</head>
<!-- <link href="./styles/hello.css" rel="stylesheet"> -->
<body onload="geoFindMe()">
	<div class="wrapper">
		<div id="out"></div>
		{{{body}}}
	</div>
<script>
function geoFindMe() {

  var output = document.getElementById("out");

  if (!navigator.geolocation){
    output.innerHTML = "<p>Geolocation is not supported by your browser</p>";
    return;
  }

  function success(position) {
  	var loc = {};

    loc.lat  = position.coords.latitude;
    loc.lng = position.coords.longitude;

    $.ajax({
	  type: "POST",
	  url: '/location',
	  data: loc
	});

    output.innerHTML = '<p>Latitude is ' + loc.lat + '° <br>Longitude is ' + loc.lng + '°</p>';

    var img = new Image();
    img.src = "https://maps.googleapis.com/maps/api/staticmap?center=" + loc.lat + "," + loc.lng + "&zoom=13&size=300x300&sensor=false";

    output.appendChild(img);
  }

  function error() {
    output.innerHTML = "Unable to retrieve your location";
  }

  output.innerHTML = "<p>Locating…</p>";

  navigator.geolocation.getCurrentPosition(success, error);
}
</script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
<!--     <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmtwJPBjIZQDv0cRYvpmEBhrJdynHPGKw"
    async defer></script> -->
</body>
</html>